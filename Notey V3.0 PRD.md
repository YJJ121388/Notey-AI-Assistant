# 📝 Notey V3.0 PRD/迭代文档

| 版本 | 日期 | 修改人 | 备注 |
| :--- | :--- | :--- | :--- |
| **v3.0** | **2026-01-15** | **YJJ121388** | **AI 拓展助手**：基于现有笔记的主动知识补全与高热内容追加 |
| v2.0 | 2026-01-10 | YJJ121388 | **架构重构**：独立 App 化，引入自定义 API、读写分离编辑与本地数据主权 |
| v1.0 | 2026-12-08 | YJJ121388 | MVP 初始版本定义 |

## 1. 项目背景 & 迭代目标

### 1.1 场景痛点
用户在复盘或阅读已生成的笔记时（例如一篇“厦门旅游攻略”），常常发现内容不够全面（例如缺了某个热门景点或避雷指南）。此时用户被迫**切出 App** 去小红书/抖音搜索，手动筛选高赞内容再复制回来，打断了学习/阅读心流。

### 1.2 迭代目标 (v3.0)
从“被动记录工具”升级为 **“主动式 AI 知识助手”**。
* **核心能力**：**In-App Content Expansion (端内内容拓展)**。
* **核心策略**：**High-Traffic Filtering (高热内容筛选)** —— AI 不会随便找个结果，而是专门寻找外部平台（如小红书、知乎、B站）浏览量高、点赞高的“公认优质内容”进行补充。

---

## 2. 核心交互链路 (Core User Flows) 

### 2.1 🤖 AI 智能拓展链路 (AI Expansion Flow)

1.  **触发 (Trigger)**：
    * 场景：用户正在阅读/编辑一篇笔记（如《Python 爬虫基础》）。
    * 动作：点击右下角 **"✨ AI 拓展 (Expand)"** 悬浮按钮。
2.  **分析与搜索 (Analyze & Search)**：
    * **上文分析**：AI 读取当前笔记，提取核心实体（Keywords: "Python 爬虫", "库"）。
    * **策略执行**：后台构建特定 Query（如 `"Python 爬虫 必学库 site:zhihu.com 高赞"`, `"厦门 避雷 site:xiaohongshu.com"`）。
    * **高热筛选**：调用搜索 API，并利用 LLM 过滤出带有“高赞”、“热榜”、“精华”、“万赞”等特征的内容源。
3.  **呈现与选择 (Present & Select)**：
    * 弹窗展示 **"AI 推荐补充"** 列表（带来源标签，如 `🔥 知乎高赞`）。
    * 用户勾选感兴趣的补充点（如 `[ ] Scrapy 框架详解`）。
4.  **追加 (Append)**：
    * 点击“添加”，内容自动以 Markdown 引用块的形式追加到笔记末尾（或指定位置）。
**🤖 AI 助手拓展链路图示 (AI Assistant Expansion Flow)**

```
┌─────────────────────────────────────────────────────────────┐
│                      笔记详情页                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  厦门旅游攻略                                        │   │
│  │  ─────────────────                                  │   │
│  │  🏝️ 鼓浪屿 - 世界文化遗产，必去打卡                  │   │
│  │  🏘️ 曾厝垵 - 文艺小渔村，美食聚集地                  │   │
│  │  ...                                                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                              ┌───┐         │
│                                              │🤖│ ← 浮窗按钮│
│                                              └───┘         │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ 点击
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    AI 助手弹窗                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🔍 正在为你搜索更多厦门景点推荐...                    │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ 搜索 + LLM 处理
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    AI 推荐结果                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  AI 为你找到以下推荐：                                │   │
│  │                                                      │   │
│  │  ☑️ 🌊 沙坡尾                                        │   │
│  │     厦门最文艺的老街区，咖啡馆和涂鸦墙的天堂          │   │
│  │                                                      │   │
│  │  ☐ 🚴 环岛路                                         │   │
│  │     骑行看海的最佳路线，全长约 31 公里                │   │
│  │                                                      │   │
│  │  ☑️ 🛍️ 中山路                                        │   │
│  │     百年老街，闽南骑楼建筑 + 各种小吃                 │   │
│  │                                                      │   │
│  │  ☐ 🌅 白城沙滩                                       │   │
│  │     厦大旁的免费沙滩，看日落绝佳位置                  │   │
│  │                                                      │   │
│  │              [ 添加选中内容到笔记 ]                   │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ 用户选择 + 点击添加
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      笔记详情页（更新后）                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  厦门旅游攻略                                        │   │
│  │  ─────────────────                                  │   │
│  │  🏝️ 鼓浪屿 - 世界文化遗产，必去打卡                  │   │
│  │  🏘️ 曾厝垵 - 文艺小渔村，美食聚集地                  │   │
│  │  ...                                                │   │
│  │  ─────────────────                                  │   │
│  │  📌 AI 推荐补充                                      │   │
│  │  🌊 沙坡尾 - 厦门最文艺的老街区...                   │   │
│  │  🛍️ 中山路 - 百年老街，闽南骑楼建筑...              │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 技术处理流程

```
用户点击 AI 助手按钮
        │
        ▼
┌───────────────────┐
│  Step 1: 主题提取  │
│  LLM 分析笔记内容  │
│  提取：主题、格式  │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  Step 2: 联网搜索  │
│  调用搜索 API      │
│  获取相关内容      │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  Step 3: 内容整理  │
│  LLM 筛选 + 格式化 │
│  匹配笔记风格      │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│  Step 4: 结构化输出│
│  返回 JSON 数组    │
│  供 App 渲染选择   │
└───────────────────┘
```

---

## 3. V3.0 技术架构

### 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                       Notey App (iOS)                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  NoteDetailView                                      │   │
│  │    └── AIAssistantButton (浮窗)                      │   │
│  │          └── AIAssistantSheet (弹窗)                 │   │
│  │                └── RecommendationList (选择列表)     │   │
│  └─────────────────────────────────────────────────────┘   │
└───────────────────────────┬─────────────────────────────────┘
                            │ HTTPS
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Notey Backend Service                    │
│                    (Node.js / Python)                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  /api/expand                                         │   │
│  │    ├── 接收：笔记内容                                 │   │
│  │    ├── 调用：搜索 API + LLM API                      │   │
│  │    └── 返回：结构化推荐列表                           │   │
│  └─────────────────────────────────────────────────────┘   │
└──────────┬────────────────────────────┬─────────────────────┘
           │                            │
           ▼                            ▼
┌─────────────────────┐      ┌─────────────────────┐
│    Search API       │      │      LLM API        │
│  (Serper / Bing)    │      │  (Claude / GPT)     │
│                     │      │                     │
│  - 实时搜索结果      │      │  - 主题提取          │
│  - 热门内容排序      │      │  - 内容筛选          │
│                     │      │  - 格式化输出        │
└─────────────────────┘      └─────────────────────┘
```
---

## 4. 功能需求清单 (Feature List)

### P0 (Must Have)

#### 1. AI 拓展助手 (In-App Agent)
- [ ] **悬浮入口**：笔记详情页增加 AI 助手入口。
- [ ] **上下文理解**：Prompt 需包含“基于这篇笔记的内容，寻找缺失的关键信息”指令。

#### 2. 高热内容搜索引擎 (Search Strategy)
- [ ] **搜索源配置**：接入 Serper (Google) 或 Bing API。
- [ ] **高流量策略 (Traffic Strategy)**：
    - [ ] **Query 构造**：自动在搜索词后追加 `"高赞"`, `"避雷"`, `"必看"`, `"Top 10"` 等限定词。
    - [ ] **结果清洗**：通过 LLM 识别搜索摘要中的热度信号（如“10万+阅读”、“收藏过万”），优先展示此类结果。

#### 3. 结构化追加 (Formatted Append)
- [ ] **追加样式**：新增内容需与原文有明显区分（如使用 `> 引用` 样式或不同背景色）。
- [ ] **来源标注**：自动附带信息来源（如 `来源：知乎热榜`），保持信息可溯源。

### P1 (Should Have)

- [ ] **多模态补充**：若搜索结果包含关键图片（如“景点地图”），尝试提取并插入笔记。
- [ ] **反向去重**：AI 需检测搜索到的内容是否已经存在于当前笔记中，避免废话文学。

---

## 4. UI/UX 规范

* **推荐卡片**：展示 `标题` + `摘要` + `热度标签`（如 🔥）。
* **追加反馈**：追加成功后，页面自动滚动到新增内容处，并闪烁高亮一次。
