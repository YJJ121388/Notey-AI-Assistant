# 开发日志 - 2026年1月16日

## 今日开发概览

今天主要完成了 Notey App 的多项功能完善，包括默认文件夹、笔记移动、新添加标记、启动页等模块。

---

## 一、默认文件夹功能

### 需求
在"我的笔记"子库中添加一个默认文件夹，始终显示在第一位，只提供收藏星标交互，不提供更多选项。

### 实现

**1. 创建 DefaultFolderRow 组件**

与 FolderRow 类似，但移除了"更多选项"按钮：

```swift
struct DefaultFolderRow: View {
    let folder: Folder
    let isExpanded: Bool
    let isFavorited: Bool
    let onTap: () -> Void
    let onFavorite: () -> Void
    // 只有收藏星标，没有更多选项按钮
}
```

**2. 独立状态管理**

默认文件夹作为独立的 `@State` 管理，不放在 `personalLibrary` 数组中：
- 不可删除、不可重命名
- 始终保持在第一位
- 独立管理更清晰

**3. CategorySheet 集成**

分类时默认文件夹始终显示在列表最前面。

---

## 二、HomeView 未分类笔记优化

### 1. 限制显示数量

只显示最近 6 条未分类笔记，避免列表过长。

### 2. 提示卡片

在末尾添加可点击的提示卡片：
- 文案："过往记录但未归档笔记可以在我的笔记页面的未分类笔记库中查看哦"
- 点击后跳转到 LibraryView 并自动滚动到未分类区域

### 实现要点

```swift
// 点击提示卡片
onViewAllUncategorized: {
    scrollToUncategorized = true
    activeTab = .notes
}

// LibraryView 中处理滚动
.onAppear {
    if scrollToUncategorized {
        isUncategorizedExpanded = true
        proxy.scrollTo("uncategorizedSection", anchor: .top)
    }
}
```

---

## 三、分类后文件夹自动展开

### 需求
用户在 CategorySheet 中选择文件夹后，LibraryView 中对应的文件夹自动展开并滚动到该位置。

### 实现

```swift
// ContentView 中
@State private var expandFolderId: String? = nil

// 分类成功后设置
expandFolderId = folderId

// LibraryView 中监听变化
.onChange(of: expandFolderId) { oldValue, newValue in
    if let folderId = newValue {
        isMyNotesExpanded = true
        expandedFolders.insert(folderId)
        proxy.scrollTo("folder-\(folderId)", anchor: .center)
    }
}
```

---

## 四、新添加笔记标记（绿色圆点）

### 需求
刚被分类归档的笔记，在卡片右侧显示绿色小圆点，点击进入后消失。

### 实现

**1. NoteRow 添加参数**

```swift
var isNewlyAdded: Bool = false

// 显示绿色圆点
if isNewlyAdded {
    Circle()
        .fill(Color.green)
        .frame(width: 8, height: 8)
}
```

**2. 状态管理**

```swift
@State private var newlyAddedNoteIds: Set<String> = []

// 分类时添加
newlyAddedNoteIds.insert(noteId)

// 点击时移除
newlyAddedNoteIds.remove(noteId)
```

---

## 五、笔记移动功能

### 需求
在 ActionSheet 中添加"移动至其他文件夹"按钮，支持将笔记从一个文件夹移动到另一个。

### 实现

**1. ActionSheetView 添加移动按钮**

```swift
let onMove: (() -> Void)?

// 蓝色图标，白色背景和文字
if let onMove = onMove {
    Button(action: {
        dismiss()
        DispatchQueue.main.asyncAfter(deadline: .now() + 0.3) {
            onMove()
        }
    }) {
        // 移动按钮 UI
    }
}
```

**2. 移动逻辑**

```swift
func moveNoteBetweenFolders(noteId: String, fromFolderId: String, toFolderId: String) {
    // 1. 从源文件夹移除
    // 2. 添加到目标文件夹
    // 3. 设置展开目标文件夹
    // 4. 标记为新添加
    // 5. 显示 Toast
}
```

**3. 记录来源文件夹**

```swift
@State private var actionSheetSourceFolderId: String?

// 点击更多时记录
onMore: {
    actionSheetId = note.id
    actionSheetSourceFolderId = folder.id
}
```

---

## 六、收藏库逻辑修复

### 问题
收藏的笔记移动到新文件夹后，新文件夹没有出现在收藏库中。

### 修复

`foldersWithFavorites` 需要同时检查默认文件夹和普通文件夹：

```swift
var foldersWithFavorites: [Folder] {
    var result: [Folder] = []
    
    // 检查默认文件夹
    if favorites.contains(defaultFolder.id) ||
       defaultFolder.children?.contains(where: { favorites.contains($0.id) }) == true {
        result.append(defaultFolder)
    }
    
    // 检查其他文件夹
    result.append(contentsOf: personalLibrary.filter { ... })
    
    return result
}
```

---

## 七、启动页（SplashView）

### 需求
App 启动时显示加载页面，展示 Notey logo。

### 实现

```swift
struct SplashView: View {
    var body: some View {
        ZStack {
            // 渐变背景
            LinearGradient(...)
            
            // 动态光斑
            BackgroundBlobsView()
            
            // Logo
            Text("Notey")
                .font(.aclonica(size: 96))
                .foregroundColor(.white)
        }
    }
}
```

**NoteyApp 中控制显示**

```swift
@State private var isLoading = true

if isLoading {
    SplashView()
        .onAppear {
            DispatchQueue.main.asyncAfter(deadline: .now() + 1.5) {
                withAnimation { isLoading = false }
            }
        }
} else {
    ContentView()
}
```

---

## 八、V3.0 产品规划

### AI 助手功能设计

通过用户访谈确定了 AI 助手的核心价值：
- 提供笔记中「没有」的信息
- 联网搜索 + LLM 整理
- 用户选择性添加到笔记

### 技术架构

```
App → 后端服务 → 搜索 API + LLM API
```

### 交互方案

采用"选择性添加"模式：
1. 用户点击 AI 助手浮窗
2. AI 返回结构化推荐列表
3. 用户勾选需要的内容
4. 一键添加到笔记末尾

详细方案已整理到 `docs/Iteration_Plan.md`。

---

## 九、今日完成的功能清单

1. ✅ 默认文件夹功能（DefaultFolderRow 组件）
2. ✅ HomeView 未分类笔记限制 6 条 + 提示卡片
3. ✅ 提示卡片点击跳转并滚动到未分类区域
4. ✅ 分类后文件夹自动展开并滚动
5. ✅ 新添加笔记绿色圆点标记
6. ✅ ActionSheet 添加"移动至其他文件夹"功能
7. ✅ 笔记在文件夹间移动逻辑
8. ✅ 收藏库包含默认文件夹的修复
9. ✅ 收藏库中笔记移动功能修复
10. ✅ ActionSheet 按钮视觉统一
11. ✅ 启动页（SplashView）
12. ✅ V3.0 AI 助手功能规划文档

---

## 十、UX 设计理念记录

### 多入口设计

同一功能提供多个触发入口：
- HomeView 未分类卡片：快速处理
- LibraryView 未分类区域：完整管理

### 设计原则

1. **用户心智模型匹配**：不同页面满足不同预期
2. **渐进式披露**：首页简洁，详情页完整
3. **容错性设计**：多入口防止遗漏
4. **一致性**：相同操作流程

---

## 十一、涉及文件清单

| 文件 | 操作 |
|------|------|
| `Notey/Components/DefaultFolderRow.swift` | 新建 |
| `Notey/Views/SplashView.swift` | 新建 |
| `Notey/Views/Main/LibraryView.swift` | 修改 |
| `Notey/Views/Main/HomeView.swift` | 修改 |
| `Notey/ContentView.swift` | 修改 |
| `Notey/NoteyApp.swift` | 修改 |
| `Notey/Components/NoteRow.swift` | 修改 |
| `Notey/Sheets/ActionSheetView.swift` | 修改 |
| `docs/Iteration_Plan.md` | 修改（添加 V3.0） |

---

*记录人：独立开发者*
*项目：Notey - AI 笔记助手*
