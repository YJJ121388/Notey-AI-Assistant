# 📝 Notey 产品需求文档 (PRD)

| 版本 | 日期 | 修改人 | 备注 |
| :--- | :--- | :--- | :--- |
| v1.3 | 2026-01-09 | YJJ121388 | 新增失败重试机制与状态流转 |
| v1.2 | 2026-01-08 | YJJ121388 | 支持用户自定义文件夹与颜色系统 |
| v1.0 | 2026-01-08 | YJJ121388 | MVP 初始版本定义 |

## 1. 项目背景
在碎片化信息时代，用户面临“收藏从未停止，学习从未开始”和“秒切学习状态还是继续娱乐活动”的困境。Notey 旨在通过 AI 自动化流程，将“被动收藏”和“遗憾错过”转化为“结构化笔记”，并提供分类管理能力。

## 2. 核心交互链路 (Core User Flows) 🌟

### 2.1 ⚡️ 捕获链路 (The Capture Flow)
1.  **触发**：用户点击视频 APP 的“分享”按钮 -> 选择 **Notey**。
2.  **处理**：后台静默运行，提取 URL -> 请求 Coze Agent。
3.  **分支 A (成功)**：
    * Coze 返回总结 -> 保存为 `Completed` 状态。
    * 发送通知：“✅ 笔记已生成！”
4.  **分支 B (失败)**：
    * 网络超时或 API 报错 -> 保存原始链接为 `Failed` 状态。
    * 发送通知：“⚠️ AI 分析暂停，已存入草稿箱，点击可重试。”

### 2.2 🔄 重试与补救链路 (The Retry Flow)
> 场景：之前因为没网导致 AI 分析失败，用户现在联网了，想重新生成。

1.  **发现**：用户进入 App，看到列表顶部有标红的“待处理/草稿”笔记。
2.  **操作**：点击进入详情页 -> 点击显著的 **“✨ 重新请求 AI 分析”** 按钮。
3.  **反馈**：按钮变为 Loading 状态 -> 分析成功 -> 界面自动刷新为 AI 总结内容 -> 状态变更为 `Completed`。

### 2.3 🗂 管理链路 (The Management Flow)
* **查看**：浏览笔记列表。
* **归档**：将笔记移动到自定义文件夹（如“Python学习”）。
* **编辑/删除**：修正内容或移除卡片。

## 3. 功能需求清单 (Feature List)

### P0 (MVP 核心功能 )
- [ ] **笔记状态机**：数据库新增 `status` 字段 (Processing/Success/Failed)。
- [ ] **兜底保存**：当 AI 失败时，强制保存 URL 和临时标题。
- [ ] **手动重试 (Retry)**：在详情页提供“重新分析”按钮，仅针对 Failed 状态笔记显示。
- [ ] **分享扩展**：接收 URL 并触发处理。
- [ ] **AI 智能解析**：对接 Coze API。

### P1 (v1.1 迭代功能 )
- [ ] **草稿箱 UI**：首页增加“待处理”专门的分区或筛选器。
- [ ] **自定义文件夹**：创建/重命名/颜色标记文件夹。
- [ ] **自动重试**：App 启动时自动检查并重试所有失败任务（后台静默重试）。

## 4. UI/UX 规范
* **状态视觉**：
    * ✅ 成功：正常显示。
    * 🔴 失败：卡片左侧显示红色竖条，或标题旁显示“⚠️”图标。
    * 🟡 处理中：显示旋转的 Loading 圈。
* **重试交互**：重试按钮应放在显眼位置（如页面中心或底部悬浮），引导用户点击。
