# Notey AI Assistant 后端架构调研报告：影子浏览器与多维信息捕获策略

## 1. 架构核心策略：从“云端爬虫”到“客户端代理”

Notey AI Assistant 的后端架构核心在于采用了 **“影子浏览器（Shadow Browser）”** 模式，这是一种将数据抓取逻辑从传统的服务器端转移到客户端（iOS Native App）的创新策略。这一转变旨在解决独立开发者在面对大型“围墙花园”平台（如抖音、小红书）时面临的**合规性**和**反爬虫**两大核心挑战。

### 1.1 影子浏览器（Shadow Browser）机制详解

| 核心组件 | 技术实现 | 解决的核心问题 |
| :--- | :--- | :--- |
| **Shadow Browser** | 基于 iOS 的 `WKWebView` 深度定制 | 模拟真实用户行为，处理复杂的登录、验证码和动态加载。 |
| **资源嗅探** | JS 注入 + 网络请求监听 | 在用户授权下，利用用户自身的登录态（Cookie）获取加密的视频流地址和正文 DOM 结构。 |
| **Serverless Gateway** | 阿里云函数计算（无状态） | 负责调用 LLM 进行总结和结构化处理，不承担抓取任务，确保计算资源即用即焚，合规性高。 |
| **Local-First** | SwiftData 本地存储 | 确保数据主权归用户所有，降低云端存储的法律风险。 |

## 2. 核心技术瓶颈清算：音视频流获取的现实障碍

在对抖音等平台进行技术调研后，我们必须正视两个核心技术障碍：

### 2.1 动态签名与 Serverless 的冲突（下载障碍）

*   **障碍**：视频流 URL 带有**动态签名（Token）**。
*   **现实**：影子浏览器在客户端嗅探到的 URL，无法被 Serverless Gateway（云端 IP）用于下载，会导致 **403 Forbidden** 错误。这使得通过云端下载音频文件进行 ASR 的路径被阻断。

### 2.2 官方无字幕接口（内容障碍）

*   **障碍**：抖音等平台**不提供**公开的、可供程序直接提取的 ASR 字幕流。
*   **现实**：视频中的语音内容要么被压制在画面中（硬字幕），要么根本没有字幕。这使得通过简单的 JS 注入来获取视频语音内容的策略失效。

## 3. 核心突破口：多维信息捕获策略（Multi-Dimensional Capture）

基于上述现实障碍，Notey 的核心技术突破口必须从“获取音频流”转向 **“多维信息捕获”**，构建一个以**视觉分析**为核心、以**文本提取**为辅助的双重保障机制。

### 3.1 核心方案：视频关键帧视觉分析（Visual Keyframe Analysis）

这是 Notey 获取视频内容的核心方案，它将 Notey 从“听众”转变为“观众”。

*   **核心思路**：利用 HTML5 `<canvas>` 元素对正在播放的 `<video>` 标签进行定时“抽帧”，将关键帧图片发送给多模态大模型进行分析。
*   **技术优势**：
    *   **绕过加密**：只要视频在浏览器里能播，Canvas 就能截到图，完美绕过动态签名限制。
    *   **信息增强**：捕获 PPT、代码演示、图表等视觉信息，弥补 ASR 缺失的视觉干货。
    *   **轻量高效**：只传输 10-15 张关键帧图片（几百 KB），而非完整的视频文件（几十 MB），极大地降低了 Serverless 的计算和传输成本。

### 3.2 辅助方案：UI 自动化采集（UI Automation）

作为获取辅助文本信息的第一级降级方案。

*   **核心思路**：利用 iOS 的 `Accessibility Services` 原理，在后台模拟用户操作，直接从渲染后的 UI 树中读取**视频描述、热评、官方 AI 笔记**等辅助文本。
*   **技术优势**：
    *   **合规稳定**：在用户本机进行，避开 IP 漂移问题，且直接读取 UI 树比解析不稳定的 DOM 结构更可靠。
    *   **文本保底**：确保在无法进行视觉分析时，依然能获取到视频的文本摘要信息。

### 3.3 保底方案：端侧 OCR 实时流处理（Vision 框架）

作为所有基于代码解析方案失败后的最终保底方案。

*   **核心思路**：利用 iOS 原生的 `Vision` 框架，实时捕获屏幕图像流，直接在 **端侧（Local Device）** 进行高频 OCR 识别。
*   **技术优势**：
    *   **终极鲁棒性**：无论平台如何加密或反抓取，只要用户能看到硬字幕，Vision 框架就能识别。
    *   **零服务器成本**：OCR 计算在用户手机上完成，服务器只负责最后的 LLM 总结。

## 4. 补充：官方 AI 笔记脚本抓取（待考察）

这是一个 **“借力打力”** 的实验性方案，旨在利用平台已有的算力，实现最高效的总结获取。

*   **方案设想**：通过 JS 脚本在影子浏览器中模拟点击“AI 笔记”按钮，等待面板弹出后，抓取其中的结构化总结文本。
*   **优势**：如果可行，可以**瞬间**获取高质量总结，完全避免了关键帧分析和 OCR 的计算成本。
*   **待考察风险**：
    1.  **覆盖率**：并非所有视频都有 AI 笔记，需要建立完善的**补位机制**（即自动切换到关键帧分析）。
    2.  **稳定性**：AI 笔记的 DOM 结构、加载方式极易变动，且频繁的自动化点击可能触发平台的异常行为检测。
    3.  **合规性**：虽然抓取的是已展示内容，但依赖于模拟点击，其合规性边界需要进一步考察。


