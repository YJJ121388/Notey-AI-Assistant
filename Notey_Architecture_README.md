# Notey AI Assistant 后端架构调研报告：影子浏览器与合规性挑战

## 1. 架构核心策略：从“云端爬虫”到“客户端代理”

Notey AI Assistant 的后端架构核心在于采用了**“影子浏览器（Shadow Browser）”**模式，这是一种将数据抓取逻辑从传统的服务器端转移到客户端（iOS Native App）的创新策略。这一转变旨在解决独立开发者在面对大型“围墙花园”平台（如抖音、小红书）时面临的**合规性**和**反爬虫**两大核心挑战。

### 1.1 影子浏览器（Shadow Browser）机制详解

| 核心组件 | 技术实现 | 解决的核心问题 |
| :--- | :--- | :--- |
| **Shadow Browser** | 基于 iOS 的 `WKWebView` 深度定制 | 模拟真实用户行为，处理复杂的登录、验证码和动态加载。 |
| **资源嗅探** | JS 注入 + 网络请求监听 | 在用户授权下，利用用户自身的登录态（Cookie）获取加密的视频流地址和正文 DOM 结构。 |
| **Serverless Gateway** | 阿里云函数计算（无状态） | 负责调用 LLM 进行总结和结构化处理，不承担抓取任务，确保计算资源即用即焚，合规性高。 |
| **Local-First** | SwiftData 本地存储 | 确保数据主权归用户所有，降低云端存储的法律风险。 |

## 2. 批判性分析：音视频流获取的“最后一公里”瓶颈

在技术调研过程中，我们深入讨论了 Notey 架构在获取**原始音视频流**时面临的挑战。

### 2.1 动态签名与 Serverless 的冲突

尽管影子浏览器能够嗅探到视频流的 URL，但该 URL 带有**动态签名（Token）**。

| 阶段 | 发生地点 | 挑战 |
| :--- | :--- | :--- |
| **嗅探** | 客户端（用户 iPhone IP） | 成功获取 URL，但该 URL 仅对当前 IP 和设备有效。 |
| **下载** | Serverless Gateway（阿里云数据中心 IP） | Serverless 尝试使用该 URL 下载时，因 IP 地址不匹配，会被平台服务器拒绝（403 Forbidden）。 |

**结论：** 影子浏览器方案在**合规性**上取得了巨大成功，但难以实现**“嗅探 URL -> 云端下载 -> ASR 转录”**的完整链路。

### 2.2 架构的真实意图：从“录音”转向“文本提取”

根据架构设计，我们推测 Notey 实际上采取了更高效、更安全的策略：

> **通过 JS 注入，直接提取平台官方提供的字幕、文案或 AI 笔记等结构化文本，而非强行获取原始音频流。**

这种策略的优势在于：
*   **质量保证**：利用了平台官方的 ASR 结果，质量高于独立开发者自行 ASR。
*   **效率极高**：避免了下载大文件和复杂的 ASR 计算。
*   **合规性高**：抓取的是已在页面上公开展示的文本信息。

## 3. 潜在的技术风险与未来方向

| 风险点 | 描述 | 应对策略 |
| :--- | :--- | :--- |
| **DOM 结构变动** | 平台一旦改版，JS 注入的 DOM 路径将失效，导致解析失败。 | 引入**配置热更新**机制，无需用户更新 App 即可修复解析逻辑。 |
| **JS 注入失败** | 平台使用 Shadow DOM 或 Canvas 渲染关键信息，导致 JS 无法获取文本。 | 建立**多级降维方案**：第一级（JS 注入）失败后，降级到第二级（OCR 识别截图）作为保底。 |
| **性能与功耗** | 后台运行 `WKWebView` 持续进行嗅探和解析，可能导致 App 耗电量增加。 | 引入**任务队列**和**后台限制**，确保解析任务不会瞬间拉满 CPU，影响用户体验。 |

## 4. 总结

Notey 的 V2.0 架构是一套**以合规为前提、以用户体验为核心**的创新方案。它巧妙地利用了客户端的优势，将技术风险转化为产品壁垒，是独立开发者在“围墙花园”中生存和发展的典范。
